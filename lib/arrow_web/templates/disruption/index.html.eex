<div class="row my-3">
  <div class="col">
    <a class="btn btn-primary" href="/disruptions/new">+ create new</a>
  </div>

  <%= form_tag(Controller.current_path(@conn), method: "get", class: "col-3") do %>
    <%= hidden_inputs_for_search(@filters) %>

    <div class="input-group">
      <input
        type="text"
        name="search"
        class="form-control"
        placeholder="search"
        value="<%= @filters.search %>"
      />

      <%= if @filters.search do %>
        <div class="input-group-append">
          <%= link("✖",
                class: "btn btn-outline-secondary",
                title: "clear search",
                to: update_filters_path(@conn, %{@filters | search: nil})
              ) %>
        </div>
      <% end %>

      <div class="input-group-append">
        <button type="submit" class="btn btn-outline-secondary" title="search">🔎</button>
      </div>
    </div>
  <% end %>
</div>

<div class="row">
  <div class="col">
    <div class="my-3 d-flex align-items-center">
      <%= for route <- filter_routes() do %>
        <% show_as_active? = MapSet.size(@filters.routes) == 0 or route in @filters.routes %>
        <% active_class = if(show_as_active?, do: "active", else: "") %>

        <%= link(
              route_icon(@conn, route, "lg"),
              class: "mr-1 m-disruption-index__route_filter #{active_class}",
              "aria-label": route,
              to: update_filters_path(@conn, Filters.toggle_route(@filters, route))
            ) %>
      <% end %>

      <%= if not Filters.calendar?(@filters) do %>
        <%= link("include past",
              class:
                "mx-2 btn btn-outline-secondary" <>
                  if(@filters.view.include_past, do: " active", else: ""),
              to: update_view_path(@conn, @filters, :include_past, !@filters.view.include_past)
            ) %>
      <% end %>

      <%= if Filters.resettable?(@filters) do %>
        <%= link("reset filters",
              class: "btn btn-link",
              to: update_filters_path(@conn, Filters.reset(@filters))
            ) %>
      <% end %>

      <%= link("⬒ #{if(Filters.calendar?(@filters), do: "list", else: "calendar")} view",
            class: "ml-auto btn btn-outline-secondary",
            to: update_filters_path(@conn, Filters.toggle_view(@filters))
          ) %>
    </div>
  </div>
</div>

<div class="row">
  <div class="col">
    <%= if Filters.calendar?(@filters) do %>
      <%= react_component("Components.DisruptionCalendar", calendar_props(@disruptions)) %>
    <% else %>
      <%= render("_table.html", conn: @conn, disruptions: @disruptions, filters: @filters) %>
    <% end %>
  </div>
</div>
